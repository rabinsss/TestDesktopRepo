OBJECT Table 5092 Opportunity
{
  OBJECT-PROPERTIES
  {
    Date=09/15/15;
    Time=12:00:00 PM;
    Version List=NAVW19.00;
  }
  PROPERTIES
  {
    DataCaptionFields=No.,Description;
    OnInsert=BEGIN
               IF "No." = '' THEN BEGIN
                 RMSetup.GET;
                 RMSetup.TESTFIELD("Opportunity Nos.");
                 NoSeriesMgt.InitSeries(RMSetup."Opportunity Nos.",xRec."No. Series",0D,"No.","No. Series");
               END;
             END;

    OnDelete=VAR
               OppEntry@1000 : Record 5093;
             BEGIN
               IF Status = Status::"In Progress" THEN
                 ERROR(Text000);

               RMCommentLine.SETRANGE("Table Name",RMCommentLine."Table Name"::Opportunity);
               RMCommentLine.SETRANGE("No.","No.");
               RMCommentLine.DELETEALL;

               OppEntry.SETCURRENTKEY("Opportunity No.");
               OppEntry.SETRANGE("Opportunity No.","No.");
               OppEntry.DELETEALL;
             END;

    CaptionML=[ENU=Opportunity;
               ESM=Oportunidad;
               FRC=OpportunitÇ;
               ENC=Opportunity];
    LookupPageID=Page5123;
    DrillDownPageID=Page5123;
  }
  FIELDS
  {
    { 1   ;   ;No.                 ;Code20        ;OnValidate=BEGIN
                                                                IF "No." <> xRec."No." THEN BEGIN
                                                                  RMSetup.GET;
                                                                  NoSeriesMgt.TestManual(RMSetup."Opportunity Nos.");
                                                                  "No. Series" := '';
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=No.;
                                                              ESM=Nß;
                                                              FRC=N¯;
                                                              ENC=No.] }
    { 2   ;   ;Description         ;Text50        ;CaptionML=[ENU=Description;
                                                              ESM=Descripci¢n;
                                                              FRC=Description;
                                                              ENC=Description] }
    { 3   ;   ;Salesperson Code    ;Code10        ;TableRelation=Salesperson/Purchaser;
                                                   OnValidate=VAR
                                                                Todo@1000 : Record 5080;
                                                                Todo2@1004 : Record 5080;
                                                                OppEntry@1001 : Record 5093;
                                                                Attendee@1005 : Record 5199;
                                                                Window@1009 : Dialog;
                                                                TotalRecordsNumber@1003 : Integer;
                                                                Counter@1002 : Integer;
                                                                StartTime@1007 : Time;
                                                                EndTime@1008 : Time;
                                                              BEGIN
                                                                IF ("Salesperson Code" <> xRec."Salesperson Code") AND
                                                                   (xRec."Salesperson Code" <> '') AND
                                                                   ("No." <> '')
                                                                THEN BEGIN
                                                                  TESTFIELD("Salesperson Code");
                                                                  Todo.RESET;
                                                                  Todo.SETCURRENTKEY("Opportunity No.",Date,Closed);
                                                                  Todo.SETRANGE("Opportunity No.","No.");
                                                                  Todo.SETRANGE(Closed,FALSE);
                                                                  Todo.SETRANGE("Salesperson Code",xRec."Salesperson Code");
                                                                  TotalRecordsNumber := Todo.COUNT;
                                                                  Counter := 0;
                                                                  IF Todo.FIND('-') THEN
                                                                    IF CONFIRM(Text008,FALSE,FIELDCAPTION("Salesperson Code")) THEN BEGIN
                                                                      Window.OPEN(Text012 + Text013);
                                                                      Window.UPDATE(2,Text014);
                                                                      StartTime := TIME;
                                                                      REPEAT
                                                                        Counter := Counter + 1;
                                                                        Window.UPDATE(1,ROUND(Counter / TotalRecordsNumber * 10000,1));
                                                                        IF Todo.Type = Todo.Type::Meeting THEN BEGIN
                                                                          Todo.GetMeetingOrganizerTodo(Todo2);
                                                                          IF Todo."Salesperson Code" <> Todo2."Salesperson Code" THEN BEGIN
                                                                            Todo.VALIDATE("Salesperson Code","Salesperson Code");
                                                                            Todo.MODIFY;
                                                                          END;
                                                                          Attendee.RESET;
                                                                          Attendee.SETRANGE("To-do No.",Todo2."No.");
                                                                          Attendee.SETRANGE("Attendee No.",xRec."Salesperson Code");
                                                                          Attendee.SETRANGE("Attendee Type",Attendee."Attendee Type"::Salesperson);
                                                                          Attendee.SETRANGE("Attendance Type",Attendee."Attendance Type"::Required,Attendee."Attendance Type"::Optional);
                                                                          IF Attendee.FINDFIRST THEN BEGIN
                                                                            Attendee.VALIDATE("Attendee No.","Salesperson Code");
                                                                            Attendee.MODIFY(TRUE);
                                                                          END;
                                                                        END
                                                                        ELSE BEGIN
                                                                          Todo.VALIDATE("Salesperson Code","Salesperson Code");
                                                                          Todo.MODIFY(TRUE);
                                                                        END;
                                                                      UNTIL Todo.NEXT = 0;
                                                                      EndTime := TIME;
                                                                      Window.CLOSE;
                                                                    END;

                                                                  OppEntry.RESET;
                                                                  OppEntry.SETCURRENTKEY(Active,"Opportunity No.");
                                                                  OppEntry.SETRANGE(Active,TRUE);
                                                                  OppEntry.SETRANGE("Opportunity No.","No.");
                                                                  IF OppEntry.FIND('-') THEN
                                                                    REPEAT
                                                                      OppEntry."Salesperson Code" := "Salesperson Code";
                                                                      OppEntry.MODIFY;
                                                                    UNTIL OppEntry.NEXT = 0;

                                                                  MODIFY;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Salesperson Code;
                                                              ESM=C¢d. vendedor;
                                                              FRC=Code reprÇsentant;
                                                              ENC=Salesperson Code] }
    { 4   ;   ;Campaign No.        ;Code20        ;TableRelation=Campaign;
                                                   OnValidate=VAR
                                                                Todo@1001 : Record 5080;
                                                                OppEntry@1000 : Record 5093;
                                                              BEGIN
                                                                IF ("Campaign No." <> xRec."Campaign No.") AND
                                                                   ("No." <> '')
                                                                THEN BEGIN
                                                                  Todo.RESET;
                                                                  Todo.SETCURRENTKEY("Opportunity No.",Date,Closed);
                                                                  Todo.SETRANGE("Opportunity No.","No.");
                                                                  Todo.SETRANGE(Closed,FALSE);
                                                                  Todo.SETRANGE("Campaign No.",xRec."Campaign No.");
                                                                  IF Todo.FIND('-') THEN
                                                                    IF CONFIRM(Text008,FALSE,FIELDCAPTION("Campaign No.")) THEN
                                                                      REPEAT
                                                                        Todo."Campaign No." := "Campaign No.";
                                                                        Todo.MODIFY;
                                                                      UNTIL Todo.NEXT = 0;

                                                                  OppEntry.RESET;
                                                                  OppEntry.SETCURRENTKEY(Active,"Opportunity No.");
                                                                  OppEntry.SETRANGE(Active,TRUE);
                                                                  OppEntry.SETRANGE("Opportunity No.","No.");
                                                                  IF OppEntry.FIND('-') THEN
                                                                    REPEAT
                                                                      OppEntry."Campaign No." := "Campaign No.";
                                                                      OppEntry.MODIFY;
                                                                    UNTIL OppEntry.NEXT = 0;

                                                                  MODIFY;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Campaign No.;
                                                              ESM=Nß campa§a;
                                                              FRC=N¯ promotion;
                                                              ENC=Campaign No.] }
    { 5   ;   ;Contact No.         ;Code20        ;TableRelation=Contact;
                                                   OnValidate=VAR
                                                                Cont@1000 : Record 5050;
                                                                Todo@1002 : Record 5080;
                                                                Todo2@1005 : Record 5080;
                                                                OppEntry@1001 : Record 5093;
                                                                SalesHeader@1003 : Record 36;
                                                                Attendee@1004 : Record 5199;
                                                                Window@1007 : Dialog;
                                                                TotalRecordsNumber@1011 : Integer;
                                                                Counter@1012 : Integer;
                                                                StartTime@1008 : Time;
                                                                EndTime@1009 : Time;
                                                              BEGIN
                                                                TESTFIELD("Contact No.");
                                                                Cont.GET("Contact No.");

                                                                IF ("Contact No." <> xRec."Contact No.") AND
                                                                   (xRec."Contact No." <> '') AND
                                                                   ("No." <> '')
                                                                THEN BEGIN
                                                                  CALCFIELDS("Contact Name");
                                                                  IF ("Contact Company No." <> Cont."Company No.") AND
                                                                     (Status <> Status::"Not Started")
                                                                  THEN
                                                                    ERROR(Text009,Cont."No.",Cont.Name);

                                                                  IF ("Sales Document No." <> '') AND ("Sales Document Type" = "Sales Document Type"::Quote) THEN BEGIN
                                                                    SalesHeader.GET(SalesHeader."Document Type"::Quote,"Sales Document No.");
                                                                    IF SalesHeader."Sell-to Contact No." <> "Contact No." THEN BEGIN
                                                                      MODIFY;
                                                                      SalesHeader.SetHideValidationDialog(TRUE);
                                                                      SalesHeader.VALIDATE("Sell-to Contact No.","Contact No.");
                                                                      SalesHeader.MODIFY
                                                                    END
                                                                  END;
                                                                  Todo.RESET;
                                                                  Todo.SETCURRENTKEY("Opportunity No.",Date,Closed);
                                                                  Todo.SETRANGE("Opportunity No.","No.");
                                                                  Todo.SETRANGE(Closed,FALSE);
                                                                  Todo.SETRANGE("Contact No.",xRec."Contact No.");
                                                                  TotalRecordsNumber := Todo.COUNT;
                                                                  Counter := 0;
                                                                  IF Todo.FIND('-') THEN
                                                                    IF CONFIRM(Text008,FALSE,FIELDCAPTION("Contact No.")) THEN BEGIN
                                                                      Window.OPEN(Text012 + Text013);
                                                                      Window.UPDATE(2,Text014);
                                                                      StartTime := TIME;
                                                                      REPEAT
                                                                        Counter := Counter + 1;
                                                                        Window.UPDATE(1,ROUND(Counter / TotalRecordsNumber * 10000,1));
                                                                        IF Todo.Type = Todo.Type::Meeting THEN BEGIN
                                                                          Todo.GetMeetingOrganizerTodo(Todo2);
                                                                          Todo.VALIDATE("Contact No.","Contact No.");
                                                                          Todo.MODIFY;
                                                                          Attendee.RESET;
                                                                          Attendee.SETRANGE("To-do No.",Todo2."No.");
                                                                          Attendee.SETRANGE("Attendee No.",xRec."Contact No.");
                                                                          Attendee.SETRANGE("Attendee Type",Attendee."Attendee Type"::Contact);
                                                                          IF Attendee.FINDFIRST THEN BEGIN
                                                                            Attendee.VALIDATE("Attendee No.","Contact No.");
                                                                            Attendee.MODIFY(TRUE);
                                                                          END;
                                                                        END ELSE BEGIN
                                                                          Todo.VALIDATE("Contact No.","Contact No.");
                                                                          Todo.MODIFY(TRUE);
                                                                        END;
                                                                      UNTIL Todo.NEXT = 0;
                                                                      EndTime := TIME;
                                                                      Window.CLOSE;
                                                                    END;

                                                                  OppEntry.RESET;
                                                                  OppEntry.SETCURRENTKEY(Active,"Opportunity No.");
                                                                  OppEntry.SETRANGE(Active,TRUE);
                                                                  OppEntry.SETRANGE("Opportunity No.","No.");
                                                                  IF OppEntry.FIND('-') THEN
                                                                    REPEAT
                                                                      OppEntry.VALIDATE("Contact No.","Contact No.");
                                                                      OppEntry.MODIFY;
                                                                    UNTIL OppEntry.NEXT = 0;

                                                                  MODIFY;
                                                                END;

                                                                "Contact Company No." := Cont."Company No.";
                                                                CALCFIELDS("Contact Name","Contact Company Name");
                                                              END;

                                                   OnLookup=VAR
                                                              Cont@1000 : Record 5050;
                                                            BEGIN
                                                              IF Cont.GET("Contact No.") THEN BEGIN
                                                                IF Status <> Status::"Not Started" THEN
                                                                  Cont.SETRANGE("Company No.",Cont."Company No.");
                                                                IF PAGE.RUNMODAL(0,Cont) = ACTION::LookupOK THEN BEGIN
                                                                  xRec."Contact No." := "Contact No.";
                                                                  VALIDATE("Contact No.",Cont."No.");
                                                                END;
                                                              END;
                                                            END;

                                                   CaptionML=[ENU=Contact No.;
                                                              ESM=Nß contacto;
                                                              FRC=N¯ contact;
                                                              ENC=Contact No.] }
    { 6   ;   ;Contact Company No. ;Code20        ;TableRelation=Contact WHERE (Type=CONST(Company));
                                                   CaptionML=[ENU=Contact Company No.;
                                                              ESM=Nß empresa contacto;
                                                              FRC=N¯ compagnie contact;
                                                              ENC=Contact Company No.] }
    { 7   ;   ;Sales Cycle Code    ;Code10        ;TableRelation="Sales Cycle";
                                                   OnValidate=VAR
                                                                SalesCycle@1000 : Record 5090;
                                                              BEGIN
                                                                SalesCycle.GET("Sales Cycle Code");
                                                                SalesCycle.TESTFIELD(Blocked,FALSE);
                                                              END;

                                                   CaptionML=[ENU=Sales Cycle Code;
                                                              ESM=C¢d. ciclo ventas;
                                                              FRC=Code cycle de vente;
                                                              ENC=Sales Cycle Code] }
    { 8   ;   ;Sales Document No.  ;Code20        ;TableRelation=IF (Sales Document Type=CONST(Quote)) "Sales Header".No. WHERE (Document Type=CONST(Quote),
                                                                                                                                 Sell-to Contact No.=FIELD(Contact No.))
                                                                                                                                 ELSE IF (Sales Document Type=CONST(Order)) "Sales Header".No. WHERE (Document Type=CONST(Order),
                                                                                                                                                                                                      Sell-to Contact No.=FIELD(Contact No.))
                                                                                                                                                                                                      ELSE IF (Sales Document Type=CONST(Posted Invoice)) "Sales Invoice Header".No. WHERE (Sell-to Contact No.=FIELD(Contact No.));
                                                   OnValidate=VAR
                                                                Opp@1000 : Record 5092;
                                                                SalesHeader@1001 : Record 36;
                                                              BEGIN
                                                                IF "Sales Document No." = '' THEN BEGIN
                                                                  "Sales Document Type" := "Sales Document Type"::" ";
                                                                  IF xRec."Sales Document Type" = "Sales Document Type"::Quote THEN
                                                                    IF SalesHeader.GET(SalesHeader."Document Type"::Quote,xRec."Sales Document No.") THEN BEGIN
                                                                      SalesHeader."Opportunity No." := '';
                                                                      SalesHeader.MODIFY
                                                                    END
                                                                END ELSE
                                                                  IF "Sales Document No." <> xRec."Sales Document No." THEN BEGIN
                                                                    Opp.RESET;
                                                                    Opp.SETCURRENTKEY("Sales Document Type","Sales Document No.");
                                                                    Opp.SETRANGE("Sales Document Type","Sales Document Type");
                                                                    Opp.SETRANGE("Sales Document No.","Sales Document No.");
                                                                    IF Opp.FINDFIRST THEN
                                                                      IF Opp."No." <> "No." THEN
                                                                        ERROR(Text006,Opp."Sales Document Type",Opp."Sales Document No.",Opp."No.");

                                                                    IF xRec."Sales Document Type" = "Sales Document Type"::Quote THEN
                                                                      IF SalesHeader.GET(SalesHeader."Document Type"::Quote,xRec."Sales Document No.") THEN BEGIN
                                                                        SalesHeader."Opportunity No." := '';
                                                                        SalesHeader.MODIFY
                                                                      END;
                                                                    IF "Sales Document Type" = "Sales Document Type"::Quote THEN
                                                                      IF SalesHeader.GET(SalesHeader."Document Type"::Quote,"Sales Document No.") THEN BEGIN
                                                                        SalesHeader."Opportunity No." := "No.";
                                                                        SalesHeader.MODIFY
                                                                      END
                                                                  END;
                                                              END;

                                                   CaptionML=[ENU=Sales Document No.;
                                                              ESM=Nß documento venta;
                                                              FRC=N¯ de document de vente;
                                                              ENC=Sales Document No.] }
    { 9   ;   ;Creation Date       ;Date          ;CaptionML=[ENU=Creation Date;
                                                              ESM=Fecha creaci¢n;
                                                              FRC=Date crÇation;
                                                              ENC=Creation Date] }
    { 10  ;   ;Status              ;Option        ;CaptionML=[ENU=Status;
                                                              ESM=Estado;
                                                              FRC=êtat;
                                                              ENC=Status];
                                                   OptionCaptionML=[ENU=Not Started,In Progress,Won,Lost;
                                                                    ESM=No iniciado,En progreso,Ganado,Perdido;
                                                                    FRC=Non dÇmarrÇ,En cours,GagnÇe,Perdue;
                                                                    ENC=Not Started,In Progress,Won,Lost];
                                                   OptionString=Not Started,In Progress,Won,Lost;
                                                   Editable=No }
    { 11  ;   ;Priority            ;Option        ;InitValue=Normal;
                                                   CaptionML=[ENU=Priority;
                                                              ESM=Prioridad;
                                                              FRC=PrioritÇ;
                                                              ENC=Priority];
                                                   OptionCaptionML=[ENU=Low,Normal,High;
                                                                    ESM=Baja,Normal,Alta;
                                                                    FRC=Faible,Normal,Haut;
                                                                    ENC=Low,Normal,High];
                                                   OptionString=Low,Normal,High }
    { 12  ;   ;Closed              ;Boolean       ;CaptionML=[ENU=Closed;
                                                              ESM=Cerrado;
                                                              FRC=FermÇ;
                                                              ENC=Closed];
                                                   Editable=No }
    { 13  ;   ;Date Closed         ;Date          ;CaptionML=[ENU=Date Closed;
                                                              ESM=Fecha cerrada;
                                                              FRC=Date fermeture;
                                                              ENC=Date Closed];
                                                   Editable=No }
    { 15  ;   ;No. Series          ;Code10        ;TableRelation="No. Series";
                                                   CaptionML=[ENU=No. Series;
                                                              ESM=Nos. serie;
                                                              FRC=SÇries de n¯;
                                                              ENC=No. Series];
                                                   Editable=No }
    { 16  ;   ;Comment             ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Rlshp. Mgt. Comment Line" WHERE (Table Name=CONST(Opportunity),
                                                                                                       No.=FIELD(No.)));
                                                   CaptionML=[ENU=Comment;
                                                              ESM=Comentario;
                                                              FRC=Commentaire;
                                                              ENC=Comment];
                                                   Editable=No }
    { 17  ;   ;Current Sales Cycle Stage;Integer  ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Opportunity Entry"."Sales Cycle Stage" WHERE (Opportunity No.=FIELD(No.),
                                                                                                                     Active=CONST(Yes)));
                                                   CaptionML=[ENU=Current Sales Cycle Stage;
                                                              ESM=Etapa ciclo ventas actual;
                                                              FRC=Phase de cycle de vente actuelle;
                                                              ENC=Current Sales Cycle Stage];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 18  ;   ;Estimated Value (LCY);Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Opportunity Entry"."Estimated Value (LCY)" WHERE (Opportunity No.=FIELD(No.),
                                                                                                                      Active=CONST(Yes)));
                                                   CaptionML=[ENU=Estimated Value ($);
                                                              ESM=Valor estimado ($);
                                                              FRC=Valeur estimÇe ($);
                                                              ENC=Estimated Value ($)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 19  ;   ;Probability %       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Opportunity Entry"."Probability %" WHERE (Opportunity No.=FIELD(No.),
                                                                                                                 Active=CONST(Yes)));
                                                   CaptionML=[ENU=Probability %;
                                                              ESM=% Probabilidad;
                                                              FRC=% probabilitÇ;
                                                              ENC=Probability %];
                                                   DecimalPlaces=1:1;
                                                   Editable=No }
    { 20  ;   ;Calcd. Current Value (LCY);Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Opportunity Entry"."Calcd. Current Value (LCY)" WHERE (Opportunity No.=FIELD(No.),
                                                                                                                           Active=CONST(Yes)));
                                                   CaptionML=[ENU=Calcd. Current Value ($);
                                                              ESM=Valor actual calculado ($);
                                                              FRC=Valeur calculÇe ($);
                                                              ENC=Calcd. Current Value ($)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 21  ;   ;Chances of Success %;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Opportunity Entry"."Chances of Success %" WHERE (Opportunity No.=FIELD(No.),
                                                                                                                        Active=CONST(Yes)));
                                                   CaptionML=[ENU=Chances of Success %;
                                                              ESM=% Posibilidades de Çxito;
                                                              FRC=% chance de succäs;
                                                              ENC=Chances of Success %];
                                                   DecimalPlaces=0:0;
                                                   Editable=No }
    { 22  ;   ;Completed %         ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Opportunity Entry"."Completed %" WHERE (Opportunity No.=FIELD(No.),
                                                                                                               Active=CONST(Yes)));
                                                   CaptionML=[ENU=Completed %;
                                                              ESM=% Completado;
                                                              FRC=% terminÇ;
                                                              ENC=Completed %];
                                                   DecimalPlaces=0:0;
                                                   Editable=No }
    { 23  ;   ;Contact Name        ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Name WHERE (No.=FIELD(Contact No.)));
                                                   CaptionML=[ENU=Contact Name;
                                                              ESM=Nombre contacto;
                                                              FRC=Nom du contact;
                                                              ENC=Contact Name];
                                                   Editable=No }
    { 24  ;   ;Contact Company Name;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Name WHERE (No.=FIELD(Contact Company No.)));
                                                   CaptionML=[ENU=Contact Company Name;
                                                              ESM=Nombre empresa contacto;
                                                              FRC=Nom compagnie contact;
                                                              ENC=Contact Company Name];
                                                   Editable=No }
    { 25  ;   ;Salesperson Name    ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Salesperson/Purchaser.Name WHERE (Code=FIELD(Salesperson Code)));
                                                   CaptionML=[ENU=Salesperson Name;
                                                              ESM=Nombre vendedor;
                                                              FRC=Nom du reprÇsentant;
                                                              ENC=Salesperson Name];
                                                   Editable=No }
    { 26  ;   ;Campaign Description;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Campaign.Description WHERE (No.=FIELD(Campaign No.)));
                                                   CaptionML=[ENU=Campaign Description;
                                                              ESM=Descripci¢n campa§a;
                                                              FRC=DÇsignation promotion;
                                                              ENC=Campaign Description];
                                                   Editable=No }
    { 27  ;   ;Segment No.         ;Code20        ;TableRelation="Segment Header";
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Segment No.;
                                                              ESM=Nß segmento;
                                                              FRC=N¯ segment;
                                                              ENC=Segment No.] }
    { 28  ;   ;Estimated Closing Date;Date        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Opportunity Entry"."Estimated Close Date" WHERE (Opportunity No.=FIELD(No.),
                                                                                                                        Active=CONST(Yes)));
                                                   CaptionML=[ENU=Estimated Closing Date;
                                                              ESM=Fecha cierre estimada;
                                                              FRC=Date de fin prÇvue;
                                                              ENC=Estimated Closing Date];
                                                   Editable=No }
    { 29  ;   ;Sales Document Type ;Option        ;OnValidate=BEGIN
                                                                IF "Sales Document Type" = xRec."Sales Document Type" THEN
                                                                  EXIT;
                                                                IF "Sales Document Type" = "Sales Document Type"::" " THEN
                                                                  VALIDATE("Sales Document No.",'');
                                                              END;

                                                   CaptionML=[ENU=Sales Document Type;
                                                              ESM=Tipo doc. venta;
                                                              FRC=Type document vente;
                                                              ENC=Sales Document Type];
                                                   OptionCaptionML=[ENU=" ,Quote,Order,Posted Invoice";
                                                                    ESM=" ,Cotizaci¢n,Pedido,Factura registrada";
                                                                    FRC=" ,Devis,Commande,Facture reportÇe";
                                                                    ENC=" ,Quote,Order,Posted Invoice"];
                                                   OptionString=[ ,Quote,Order,Posted Invoice] }
    { 30  ;   ;No. of Interactions ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Interaction Log Entry" WHERE (Opportunity No.=FIELD(FILTER(No.)),
                                                                                                    Canceled=CONST(No),
                                                                                                    Postponed=CONST(No)));
                                                   CaptionML=[ENU=No. of Interactions;
                                                              ESM=Nß de interacciones;
                                                              FRC=Nbre interactions;
                                                              ENC=No. of Interactions];
                                                   Editable=No }
    { 9501;   ;Wizard Step         ;Option        ;CaptionML=[ENU=Wizard Step;
                                                              ESM=Paso asistente;
                                                              FRC=êtape de l'assistant;
                                                              ENC=Wizard Step];
                                                   OptionCaptionML=[ENU=" ,1,2,3,4,5,6";
                                                                    ESM=" ,1,2,3,4,5,6";
                                                                    FRC=" ,1,2,3,4,5,6";
                                                                    ENC=" ,1,2,3,4,5,6"];
                                                   OptionString=[ ,1,2,3,4,5,6];
                                                   Editable=No }
    { 9502;   ;Activate First Stage;Boolean       ;CaptionML=[ENU=Activate First Stage;
                                                              ESM=Activar primera etapa;
                                                              FRC=Activer la premiäre phase;
                                                              ENC=Activate First Stage] }
    { 9503;   ;Segment Description ;Text50        ;CaptionML=[ENU=Segment Description;
                                                              ESM=Descripci¢n del segmento;
                                                              FRC=Description du segment;
                                                              ENC=Segment Description] }
    { 9504;   ;Wizard Estimated Value (LCY);Decimal;
                                                   CaptionML=[ENU=Wizard Estimated Value ($);
                                                              ESM=Valor estimado asistente ($);
                                                              FRC=Assistant - Valeur estimÇe ($);
                                                              ENC=Wizard Estimated Value ($)];
                                                   AutoFormatType=1 }
    { 9505;   ;Wizard Chances of Success %;Decimal;CaptionML=[ENU=Wizard Chances of Success %;
                                                              ESM=% posibilidades Çxito asistente;
                                                              FRC=Assistant - % chance de succäs;
                                                              ENC=Wizard Chances of Success %];
                                                   DecimalPlaces=0:0 }
    { 9506;   ;Wizard Estimated Closing Date;Date ;CaptionML=[ENU=Wizard Estimated Closing Date;
                                                              ESM=Fecha cierre estimado asistente;
                                                              FRC=Assistant - Date de clìture estimÇe;
                                                              ENC=Wizard Estimated Closing Date] }
    { 9507;   ;Wizard Contact Name ;Text50        ;CaptionML=[ENU=Wizard Contact Name;
                                                              ESM=Nombre contacto asistente;
                                                              FRC=Assistant - Nom de contact;
                                                              ENC=Wizard Contact Name] }
    { 9508;   ;Wizard Campaign Description;Text50 ;CaptionML=[ENU=Wizard Campaign Description;
                                                              ESM=Descripci¢n campa§a asistente;
                                                              FRC=Assistant - Description de promotion;
                                                              ENC=Wizard Campaign Description] }
  }
  KEYS
  {
    {    ;No.                                     ;Clustered=Yes }
    {    ;Contact Company No.,Contact No.,Closed   }
    {    ;Salesperson Code,Closed                  }
    {    ;Campaign No.,Closed                      }
    {    ;Segment No.,Closed                       }
    {    ;Sales Document Type,Sales Document No.   }
  }
  FIELDGROUPS
  {
    { 1   ;DropDown            ;No.,Description,Creation Date,Status     }
  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=You cannot delete this opportunity while it is active.;ESM=No puede borrar esta oportunidad mientras estÇ activa.;FRC=Pour pouvoir àtre supprimÇe, cette opportunitÇ ne doit pas àtre active.;ENC=You cannot delete this opportunity while it is active.';
      Text001@1001 : TextConst 'ENU=You cannot create opportunities on an empty segment.;ESM=No puede crear oportunidades en un segmento cerrado.;FRC=Vous ne pouvez pas crÇer d''opportunitÇ dans un segment vide.;ENC=You cannot create opportunities on an empty segment.';
      Text002@1002 : TextConst 'ENU=Do you want to create an opportunity for all contacts in the %1 segment?;ESM=®Desea crear una oportunidad en todos los contactos del segmento %1?;FRC=Voulez-vous crÇer une opportunitÇ pour tous les contacts du segment %1?;ENC=Do you want to create an opportunity for all contacts in the %1 segment?';
      Text003@1009 : TextConst 'ENU=There is no sales quote that is assigned to this opportunity.;ESM=No hay cotizaciones de venta asignadas a esta oportunidad.;FRC=Aucun devis n''est affectÇ Ö cette opportunitÇ.;ENC=There is no sales quote that is assigned to this opportunity.';
      Text004@1003 : TextConst 'ENU=Sales quote %1 does not exist.;ESM=La cotizaci¢n de venta %1 no existe.;FRC=Le devis %1 n''existe pas.;ENC=Sales quote %1 does not exist.';
      Text005@1005 : TextConst 'ENU=You cannot assign a sales quote to the %2 record of the %1 while the %2 record of the %1 has no contact company assigned.;ESM=No puede asignar cotizaci¢n venta al registro %2 de %1 cuando el registro %2 no tiene asignado contacto empresa.;FRC=Vous ne pouvez pas crÇer de devis pour l''enregistrement %2 du %1 si aucun contact de compagnie n''a ÇtÇ affectÇ Ö l''enregistrement %2 du %1.;ENC=You cannot assign a sales quote to the %2 record of the %1 while the %2 record of the %1 has no contact company assigned.';
      RMSetup@1011 : Record 5079;
      Opp@1012 : Record 5092;
      RMCommentLine@1013 : Record 5061;
      SegHeader@1018 : Record 5076;
      OppEntry@1020 : Record 5093;
      RMCommentLineTmp@1022 : TEMPORARY Record 5061;
      NoSeriesMgt@1014 : Codeunit 396;
      Text006@1004 : TextConst 'ENU=Sales %1 %2 is already assigned to opportunity %3.;ESM=%1 %2 venta ya est† asignada a la oportunidad %3.;FRC=Le %1 %2 des ventes est dÇjÖ attribuÇ Ö l''occasion %3.;ENC=Sales %1 %2 is already assigned to opportunity %3.';
      Text008@1007 : TextConst 'ENU=Do you want to change %1 on the related open to-dos with the same %1?;ESM=®Desea cambiar %1 en las tareas abiertas relacionadas con el mismo %1?;FRC=Souhaitez-vous modifier le %1 des tÉches associÇes ouvertes indiquant le màme %1?;ENC=Do you want to change %1 on the related open to-dos with the same %1?';
      Text009@1008 : TextConst 'ENU=Contact %1 %2 is related to another company.;ESM=Contacto %1 %2 est† relacionado con otra empresa.;FRC=Le contact %1 %2 est associÇ Ö une autre compagnie.;ENC=Contact %1 %2 is related to another company.';
      Text011@1010 : TextConst 'ENU=A sales quote has already been assigned to this opportunity.;ESM=Ya se ha asignado una cotizaci¢n de venta a esta oportunidad.;FRC=Un devis a dÇjÖ ÇtÇ affectÇ Ö cette opportunitÇ.;ENC=A sales quote has already been assigned to this opportunity.';
      Text012@1017 : TextConst 'ENU=Current process @1@@@@@@@@@@@@@@@\;ESM=Proceso actual @1@@@@@@@@@@@@@@@\;FRC=Traitement en cours @1@@@@@@@@@@@@@@@\;ENC=Current process @1@@@@@@@@@@@@@@@\';
      Text013@1016 : TextConst 'ENU=Current status  #2###############;ESM=Estado actual  #2###############;FRC=êtat actuel         #2###############;ENC=Current status  #2###############';
      Text014@1015 : TextConst 'ENU=Updating To-dos;ESM=Actualizando tareas;FRC=Mise Ö jour des tÉches;ENC=Updating To-dos';
      Text022@1026 : TextConst 'ENU=You must fill in the %1 field.;ESM=Debe rellenar el campo %1.;FRC=Vous devez remplir le champ %1.;ENC=You must fill in the %1 field.';
      Text023@1025 : TextConst 'ENU=You must fill in the contact that is involved in the opportunity.;ESM=Debe seleccionar el contacto que est† relacionado con la oportunidad.;FRC=Vous devez indiquer le contact impliquÇ dans l''opportunitÇ.;ENC=You must fill in the contact that is involved in the opportunity.';
      Text024@1024 : TextConst 'ENU=%1 must be greater than 0.;ESM=%1 debe ser mayor que 0.;FRC=%1 doit àtre supÇrieur Ö 0.;ENC=%1 must be greater than 0.';
      Text025@1023 : TextConst 'ENU=The Estimated closing date has to be later than this change;ESM=La fecha estimada de cierre debe ser posterior a la fecha de esta modificaci¢n;FRC=La date de modification doit àtre antÇrieure Ö la date de fin estimÇe.;ENC=The Estimated closing date has to be later than this change';

    PROCEDURE CreateOppFromOpp@1(VAR Opp@1007 : Record 5092);
    VAR
      Cont@1001 : Record 5050;
      SalesPurchPerson@1002 : Record 13;
      Campaign@1003 : Record 5071;
      SegHeader@1004 : Record 5076;
      SegLine@1005 : Record 5077;
      SalesCycle@1006 : Record 5090;
    BEGIN
      DELETEALL;
      INIT;
      "Creation Date" := WORKDATE;
      RMSetup.GET;
      IF RMSetup."Default Sales Cycle Code" <> '' THEN
        IF SalesCycle.GET(RMSetup."Default Sales Cycle Code") THEN
          IF NOT SalesCycle.Blocked THEN
            "Sales Cycle Code" := RMSetup."Default Sales Cycle Code";
      IF Cont.GET(Opp.GETFILTER("Contact Company No.")) THEN BEGIN
        VALIDATE("Contact No.",Cont."No.");
        "Salesperson Code" := Cont."Salesperson Code";
        SETRANGE("Contact Company No.","Contact No.");
      END;
      IF Cont.GET(Opp.GETFILTER("Contact No.")) THEN BEGIN
        VALIDATE("Contact No.",Cont."No.");
        "Salesperson Code" := Cont."Salesperson Code";
        SETRANGE("Contact No.","Contact No.");
      END;
      IF SalesPurchPerson.GET(Opp.GETFILTER("Salesperson Code")) THEN BEGIN
        "Salesperson Code" := SalesPurchPerson.Code;
        SETRANGE("Salesperson Code","Salesperson Code");
      END;
      IF Campaign.GET(Opp.GETFILTER("Campaign No.")) THEN BEGIN
        "Campaign No." := Campaign."No.";
        "Salesperson Code" := Campaign."Salesperson Code";
        SETRANGE("Campaign No.","Campaign No.");
      END;
      IF SegHeader.GET(Opp.GETFILTER("Segment No.")) THEN BEGIN
        SegLine.SETRANGE("Segment No.",SegHeader."No.");
        IF SegLine.COUNT = 0 THEN
          ERROR(Text001);
        "Segment No." := SegHeader."No.";
        "Campaign No." := SegHeader."Campaign No.";
        "Salesperson Code" := SegHeader."Salesperson Code";
        SETRANGE("Segment No.","Segment No.");
      END;

      StartWizard;
    END;

    LOCAL PROCEDURE InsertOpportunity@3(VAR Opp2@1000 : Record 5092;OppEntry2@1004 : Record 5093;VAR RMCommentLineTmp@1007 : Record 5061;ActivateFirstStage@1006 : Boolean);
    VAR
      SegHeader@1001 : Record 5076;
      SegLine@1002 : Record 5077;
      SalesCycleStage@1003 : Record 5091;
      OppEntry@1005 : Record 5093;
    BEGIN
      Opp := Opp2;

      IF ActivateFirstStage THEN BEGIN
        SalesCycleStage.RESET;
        SalesCycleStage.SETRANGE("Sales Cycle Code",Opp."Sales Cycle Code");
        IF SalesCycleStage.FINDFIRST THEN
          OppEntry2."Sales Cycle Stage" := SalesCycleStage.Stage;
      END;

      IF SegHeader.GET(GETFILTER("Segment No.")) THEN BEGIN
        SegLine.SETRANGE("Segment No.",SegHeader."No.");
        SegLine.SETFILTER("Contact No.",'<>%1','');
        IF SegLine.FIND('-') THEN BEGIN
          IF CONFIRM(Text002,TRUE,SegHeader."No.") THEN
            REPEAT
              Opp."Contact No." := SegLine."Contact No.";
              Opp."Contact Company No." := SegLine."Contact Company No.";
              CLEAR(Opp."No.");
              Opp.INSERT(TRUE);
              CreateCommentLines(RMCommentLineTmp,Opp."No.");
              IF ActivateFirstStage THEN BEGIN
                OppEntry.INIT;
                OppEntry := OppEntry2;
                OppEntry.InitOpportunityEntry(Opp);
                OppEntry.InsertEntry(OppEntry,FALSE,TRUE);
                OppEntry.UpdateEstimates;
              END;
            UNTIL SegLine.NEXT = 0;
        END;
      END ELSE BEGIN
        Opp.INSERT(TRUE);
        CreateCommentLines(RMCommentLineTmp,Opp."No.");
        IF ActivateFirstStage THEN BEGIN
          OppEntry.INIT;
          OppEntry := OppEntry2;
          OppEntry.InitOpportunityEntry(Opp);
          OppEntry.InsertEntry(OppEntry,FALSE,TRUE);
          OppEntry.UpdateEstimates;
        END;
      END;
    END;

    PROCEDURE UpdateOpportunity@4();
    VAR
      TempOppEntry@1000 : TEMPORARY Record 5093;
    BEGIN
      IF "No." <> '' THEN
        TempOppEntry.UpdateOppFromOpp(Rec);
    END;

    PROCEDURE CloseOpportunity@5();
    VAR
      TempOppEntry@1000 : TEMPORARY Record 5093;
    BEGIN
      IF "No." <> '' THEN
        TempOppEntry.CloseOppFromOpp(Rec);
    END;

    PROCEDURE AssignQuote@6();
    VAR
      Cont@1001 : Record 5050;
      SalesHeader@1000 : Record 36;
    BEGIN
      Cont.GET("Contact No.");

      IF (Cont.Type = Cont.Type::Person) AND (Cont."Company No." = '') THEN
        ERROR(
          Text005,
          Cont.TABLECAPTION,Cont."No.");

      TESTFIELD(Status,Status::"In Progress");

      IF NOT SalesHeader.GET(SalesHeader."Document Type"::Quote,"Sales Document No.") THEN BEGIN
        SalesHeader.SETRANGE("Sell-to Contact No.",Cont."No.");
        SalesHeader.INIT;
        SalesHeader."Document Type" := SalesHeader."Document Type"::Quote;
        SalesHeader.INSERT(TRUE);
        SalesHeader.VALIDATE("Salesperson Code","Salesperson Code");
        SalesHeader.VALIDATE("Campaign No.","Campaign No.");
        SalesHeader."Opportunity No." := "No.";
        SalesHeader."Order Date" := GetEstimatedClosingDate;
        SalesHeader."Shipment Date" := SalesHeader."Order Date";
        SalesHeader.MODIFY;
        "Sales Document Type" := "Sales Document Type"::Quote;
        "Sales Document No." := SalesHeader."No.";
        MODIFY;
      END ELSE
        ERROR(Text011);
      PAGE.RUN(PAGE::"Sales Quote",SalesHeader);
    END;

    LOCAL PROCEDURE GetEstimatedClosingDate@8() : Date;
    VAR
      OppEntry@1000 : Record 5093;
    BEGIN
      OppEntry.SETCURRENTKEY(Active,"Opportunity No.");
      OppEntry.SETRANGE(Active,TRUE);
      OppEntry.SETRANGE("Opportunity No.","No.");
      IF OppEntry.FINDFIRST THEN
        EXIT(OppEntry."Estimated Close Date");
    END;

    PROCEDURE ShowQuote@2();
    VAR
      SalesHeader@1000 : Record 36;
    BEGIN
      IF SalesHeader.GET(SalesHeader."Document Type"::Quote,"Sales Document No.") THEN
        PAGE.RUNMODAL(PAGE::"Sales Quote",SalesHeader);
    END;

    LOCAL PROCEDURE CreateCommentLines@7(VAR RMCommentLineTmp@1001 : Record 5061;OppNo@1000 : Code[20]);
    BEGIN
      IF RMCommentLineTmp.FIND('-') THEN
        REPEAT
          RMCommentLine.INIT;
          RMCommentLine := RMCommentLineTmp;
          RMCommentLine."No." := OppNo;
          RMCommentLine.INSERT;
        UNTIL RMCommentLineTmp.NEXT = 0;
    END;

    LOCAL PROCEDURE StartWizard@11();
    VAR
      Cont@1000 : Record 5050;
      Campaign@1001 : Record 5071;
      SegHeader@1002 : Record 5076;
    BEGIN
      "Wizard Step" := "Wizard Step"::"1";

      IF Cont.GET(GETFILTER("Contact No.")) THEN
        "Wizard Contact Name" := Cont.Name
      ELSE
        IF Cont.GET(GETFILTER("Contact Company No.")) THEN
          "Wizard Contact Name" := Cont.Name;

      IF Campaign.GET(GETFILTER("Campaign No.")) THEN
        "Wizard Campaign Description" := Campaign.Description;
      IF SegHeader.GET(GETFILTER("Segment No.")) THEN
        "Segment Description" := SegHeader.Description;

      INSERT;
      PAGE.RUNMODAL(PAGE::"Create Opportunity",Rec);
    END;

    PROCEDURE PerformNextWizardStatus@9();
    VAR
      Cont@1001 : Record 5050;
    BEGIN
      "Wizard Step" := "Wizard Step" + 1;

      IF "Wizard Step" = "Wizard Step"::"2" THEN BEGIN
        CLEAR(Cont);
        IF Cont.GET(GETFILTER("Contact No.")) THEN
          "Contact Name" := Cont.Name
        ELSE
          IF Cont.GET(GETFILTER("Contact Company No.")) THEN
            "Contact Name" := Cont.Name;
      END;
    END;

    PROCEDURE PerformPrevWizardStatus@12();
    BEGIN
      "Wizard Step" := "Wizard Step" - 1;
    END;

    PROCEDURE CheckStatus@16();
    BEGIN
      CASE "Wizard Step" OF
        "Wizard Step"::"1":
          BEGIN
            IF "Creation Date" = 0D THEN
              ErrorMessage(FIELDCAPTION("Creation Date"));
            IF Description = '' THEN
              ErrorMessage(FIELDCAPTION(Description));
          END;
        "Wizard Step"::"2":
          BEGIN
            IF NOT SegHeader.GET(GETFILTER("Segment No.")) THEN
              IF "Contact No." = '' THEN
                ERROR(Text023);
            IF "Salesperson Code" = '' THEN
              ErrorMessage(FIELDCAPTION("Salesperson Code"));
            IF "Sales Cycle Code" = '' THEN
              ErrorMessage(FIELDCAPTION("Sales Cycle Code"));
          END;
        "Wizard Step"::"4":
          IF "Activate First Stage" THEN BEGIN
            IF "Wizard Estimated Value (LCY)" <= 0 THEN
              ERROR(Text024,FIELDCAPTION("Wizard Estimated Value (LCY)"));
            IF "Wizard Chances of Success %" <= 0 THEN
              ERROR(Text024,FIELDCAPTION("Wizard Chances of Success %"));
            IF "Wizard Estimated Closing Date" = 0D THEN
              ErrorMessage(FIELDCAPTION("Wizard Estimated Closing Date"));
            IF "Wizard Estimated Closing Date" < OppEntry."Date of Change" THEN
              ERROR(Text025);
          END;
      END;
    END;

    PROCEDURE FinishWizard@18() : Boolean;
    VAR
      ActivateFirstStage@1000 : Boolean;
    BEGIN
      "Wizard Step" := Opp."Wizard Step"::" ";
      ActivateFirstStage := "Activate First Stage";
      "Activate First Stage" := FALSE;
      OppEntry."Chances of Success %" := "Wizard Chances of Success %";
      OppEntry."Estimated Close Date" := "Wizard Estimated Closing Date";
      OppEntry."Estimated Value (LCY)" := "Wizard Estimated Value (LCY)";

      "Wizard Chances of Success %" := 0;
      "Wizard Estimated Closing Date" := 0D;
      "Wizard Estimated Value (LCY)" := 0;
      "Segment Description" := '';
      "Wizard Contact Name" := '';
      "Wizard Campaign Description" := '';

      InsertOpportunity(Rec,OppEntry,RMCommentLineTmp,ActivateFirstStage);
      DELETE;
    END;

    LOCAL PROCEDURE ErrorMessage@10(FieldName@1000 : Text[1024]);
    BEGIN
      ERROR(Text022,FieldName);
    END;

    LOCAL PROCEDURE ShowComments@13();
    BEGIN
      RMCommentLineTmp.SETRANGE("Table Name",RMCommentLineTmp."Table Name"::Opportunity);
      RMCommentLineTmp.SETRANGE("No.","No.");
      RMCommentLineTmp.SETRANGE("Sub No.",0);
      PAGE.RUNMODAL(PAGE::"Rlshp. Mgt. Comment Sheet",RMCommentLineTmp);
    END;

    LOCAL PROCEDURE CommentsExist@14() : Boolean;
    BEGIN
      EXIT(NOT RMCommentLineTmp.ISEMPTY)
    END;

    LOCAL PROCEDURE GetComments@64(VAR RMCommentLine@1001 : Record 5061);
    BEGIN
      RMCommentLine.DELETEALL;
      IF RMCommentLineTmp.FIND('-') THEN
        REPEAT
          RMCommentLine := RMCommentLineTmp;
          RMCommentLine.INSERT;
        UNTIL RMCommentLineTmp.NEXT = 0;
    END;

    PROCEDURE SetComments@53(VAR RMCommentLine@1001 : Record 5061);
    BEGIN
      RMCommentLineTmp.DELETEALL;

      IF RMCommentLine.FINDSET THEN
        REPEAT
          RMCommentLineTmp := RMCommentLine;
          RMCommentLineTmp.INSERT;
        UNTIL RMCommentLine.NEXT = 0;
    END;

    PROCEDURE ShowSalesQuoteWithCheck@15();
    VAR
      SalesHeader@1000 : Record 36;
    BEGIN
      IF ("Sales Document Type" <> "Sales Document Type"::Quote) OR
         ("Sales Document No." = '')
      THEN
        ERROR(Text003);

      IF NOT SalesHeader.GET(SalesHeader."Document Type"::Quote,"Sales Document No.") THEN
        ERROR(Text004,"Sales Document No.");
      PAGE.RUN(PAGE::"Sales Quote",SalesHeader);
    END;

    BEGIN
    END.
  }
}

